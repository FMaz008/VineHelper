<fieldset>
	<legend>Debugging</legend>
	<div class="vh-container">
		Enable debug logging to help diagnose issues. Debug logs will appear in the browser console.
	</div>

	<fieldset>
		<legend>Notification Monitor</legend>
		<div class="setting-container">
			<label for="general.debugTabTitle">
				<input type="checkbox" name="general.debugTabTitle" value="1" />
				Debug Tab Title Updates
			</label>
			<div class="setting-summary">
				<div class="vh-toolbar-icon vh-icon-question"></div>
				Logs detailed information about tab title count updates to help diagnose count mismatch issues.
			</div>
		</div>

		<div class="setting-container">
			<label for="general.debugPlaceholders">
				<input type="checkbox" name="general.debugPlaceholders" value="1" />
				Debug Placeholder Calculations
			</label>
			<div class="setting-summary">
				<div class="vh-toolbar-icon vh-icon-question"></div>
				Logs detailed information about placeholder tile calculations and grid layout adjustments.
			</div>
		</div>

		<div class="setting-container">
			<label for="general.debugNotifications">
				<input type="checkbox" name="general.debugNotifications" value="1" />
				Debug Notifications
			</label>
			<div class="setting-summary">
				<div class="vh-toolbar-icon vh-icon-question"></div>
				Logs detailed information about notification processing, including sound playback, OS notifications, duplicate prevention, and state machine transitions.
			</div>
		</div>
	</fieldset>

	<fieldset>
		<legend>WebSocket & Stream Debugging</legend>
		<div class="setting-container">
			<label for="general.debugWebsocket">
				<input type="checkbox" name="general.debugWebsocket" value="1" />
				Debug WebSocket Messages
			</label>
			<div class="setting-summary">
				<div class="vh-toolbar-icon vh-icon-question"></div>
				Logs WebSocket relay messages including newPreprocessedItem, unavailableItem, and newETV events.
			</div>
		</div>

		<div class="setting-container">
			<label for="general.debugServercom">
				<input type="checkbox" name="general.debugServercom" value="1" />
				Debug ServerCom Messages
			</label>
			<div class="setting-summary">
				<div class="vh-toolbar-icon vh-icon-question"></div>
				Logs ServerCom processing messages including newPreprocessedItem and newItem events with item details.
			</div>
		</div>
		<div class="setting-container">
			<label for="general.debugServiceWorker">
				<input type="checkbox" name="general.debugServiceWorker" value="1" />
				Debug Service Worker Messages
			</label>
			<div class="setting-summary">
				<div class="vh-toolbar-icon vh-icon-question"></div>
				Logs service worker messages including tab communication, notification creation, and URL handling.
			</div>
		</div>
		
		<div class="setting-container">
			<label for="general.debugCoordination">
				<input type="checkbox" name="general.debugCoordination" value="1" />
				Debug Multi-tab Coordination
			</label>
			<div class="setting-summary">
				<div class="vh-toolbar-icon vh-icon-question"></div>
				Logs master/slave coordination messages between multiple tabs including synchronization and state updates.
			</div>
		</div>
	</fieldset>

	<fieldset>
		<legend>Performance & Operations</legend>
		<div class="setting-container">
			<label for="general.debugTitleDisplay">
				<input type="checkbox" name="general.debugTitleDisplay" value="1" />
				Debug Title Display Issues
			</label>
			<div class="setting-summary">
				<div class="vh-toolbar-icon vh-icon-question"></div>
				Logs detailed information about title display operations to help diagnose issues with titles being cleared or not showing correctly. Tracks DOM mutations, text extraction, and restoration events.
			</div>
		</div>

		<div class="setting-container">
			<label for="general.debugBulkOperations">
				<input type="checkbox" name="general.debugBulkOperations" value="1" />
				Debug Bulk Operations
			</label>
			<div class="setting-summary">
				<div class="vh-toolbar-icon vh-icon-question"></div>
				Logs detailed information about bulk item removal operations, including item counts, processing steps, and performance metrics.
			</div>
		</div>

		<div class="setting-container">
			<label for="general.debugKeywords">
				<input type="checkbox" name="general.debugKeywords" value="1" />
				Debug Keyword Operations
			</label>
			<div class="setting-summary">
				<div class="vh-toolbar-icon vh-icon-question"></div>
				Logs information about keyword compilation, caching, and pattern matching operations.
			</div>
		</div>
		
		<div class="setting-container">
			<label for="general.debugSettings">
				<input type="checkbox" name="general.debugSettings" value="1" />
				Debug Settings Operations
			</label>
			<div class="setting-summary">
				<div class="vh-toolbar-icon vh-icon-question"></div>
				Logs information about settings loading, saving, and migration operations.
			</div>
		</div>
		
		<div class="setting-container">
			<label for="general.debugStorage">
				<input type="checkbox" name="general.debugStorage" value="1" />
				Debug Storage Operations
			</label>
			<div class="setting-summary">
				<div class="vh-toolbar-icon vh-icon-question"></div>
				Logs detailed information about Chrome storage read/write operations.
			</div>
		</div>
	</fieldset>

	<fieldset>
		<legend>Memory Analysis</legend>
		<div class="setting-container">
			<label for="general.debugMemory">
				<input type="checkbox" name="general.debugMemory" value="1" />
				Enable Memory Debugging
			</label>
			<div class="setting-summary">
				<div class="vh-toolbar-icon vh-icon-question"></div>
				Enables memory debugging tools in the notification monitor. When enabled, you can use <code>window.md</code> to access the MemoryDebugger instance.
				<br />
				<strong>Usage:</strong> <code>md.takeSnapshot("before")</code>, <code>md.compareSnapshots("before", "after")</code>
			</div>
		</div>

		<div class="setting-container">
			<label for="general.debugMemoryAutoSnapshot">
				<input type="checkbox" name="general.debugMemoryAutoSnapshot" value="1" />
				Auto Heap Snapshots
			</label>
			<div class="setting-summary">
				<div class="vh-toolbar-icon vh-icon-question"></div>
				Automatically takes heap snapshots at key moments (startup, after fetch, after truncation) to help identify memory leaks.
			</div>
		</div>
	</fieldset>

	<!-- Memory Debugging Controls (only visible when debugging is enabled) -->
		<div id="memoryDebugControls" class="memory-debug-controls" style="display: none;">
			<hr style="margin: 15px 0;">
			
			<div class="setting-container">
				<h4 style="margin: 10px 0; font-size: 14px;">Memory Debugging Tools</h4>
			</div>

			<div class="setting-container" style="flex-direction: column; align-items: stretch;">
				<label style="font-weight: bold; margin-bottom: 8px; font-size: 13px;">Take Snapshot:</label>
				<div style="display: flex; gap: 8px; align-items: stretch; flex-wrap: wrap;">
					<input type="text" id="snapshotName" placeholder="Snapshot name" style="
						flex: 1;
						min-width: 120px;
						padding: 6px 8px;
						font-size: 12px;
						border: 1px solid #ccc;
						border-radius: 3px;
					">
					<button id="takeSnapshotBtn" class="vh-button-icon" style="
						padding: 6px 12px;
						font-size: 12px;
						white-space: nowrap;
					">Take Snapshot</button>
				</div>
			</div>

			<div class="setting-container" style="background: #f0f8ff; padding: 10px; border-radius: 4px; margin-bottom: 12px;">
				<div style="display: flex; align-items: center; gap: 8px;">
					<span style="font-size: 16px;">‚ÑπÔ∏è</span>
					<div style="font-size: 12px; line-height: 1.4;">
						<strong>How it works:</strong> These tools analyze memory in your Vine tab (where items are displayed), not this settings page.
						Make sure you have a Vine page open before using these tools. All results show the actual state of your notification monitor.
					</div>
				</div>
			</div>

			<div class="setting-container" style="flex-direction: column; align-items: stretch;">
				<label style="font-weight: bold; margin-bottom: 8px; font-size: 13px;">Memory Analysis:</label>
				<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px; width: 100%;">
					<button id="generateReportBtn" class="vh-button-icon memory-debug-btn">Generate Report</button>
					<button id="detectLeaksBtn" class="vh-button-icon memory-debug-btn">Detect Leaks</button>
					<button id="checkDetachedBtn" class="vh-button-icon memory-debug-btn">Check Detached</button>
					<button id="cleanupBtn" class="vh-button-icon memory-debug-btn">Run Cleanup</button>
				</div>
			</div>

			<div class="setting-container" style="flex-direction: column; align-items: stretch;">
				<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
					<label style="font-weight: bold; font-size: 13px;">Memory Log:</label>
					<div style="display: flex; gap: 4px;">
						<button id="copyLogBtn" class="vh-button-icon" style="
							padding: 4px 8px;
							font-size: 11px;
							background: #f0f0f0;
							border: 1px solid #ccc;
						" title="Copy log to clipboard">üìã</button>
						<button id="clearLogBtn" class="vh-button-icon" style="
							padding: 4px 8px;
							font-size: 11px;
							background: #f0f0f0;
							border: 1px solid #ccc;
						">Clear</button>
					</div>
				</div>
				<div id="memoryDebugLog" style="
					background: #f8f8f8;
					border: 1px solid #ddd;
					border-radius: 4px;
					padding: 8px;
					height: 150px;
					overflow-y: auto;
					font-family: 'Consolas', 'Monaco', monospace;
					font-size: 11px;
					line-height: 1.4;
					white-space: normal;
					word-break: break-word;
					box-shadow: inset 0 1px 3px rgba(0,0,0,0.1);
				">
					<div style="color: #888; font-style: italic; font-size: 11px;">Memory debugging log will appear here...</div>
				</div>
			</div>
		</div>
	</fieldset>
</fieldset>